@model List<Author>

@{
    Layout = "_AdminLayout";
    ViewBag.Title = "Author Management";
}

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Author Management</h1>
    <a asp-action="Create" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
        <i class="fas fa-plus fa-sm text-white-50"></i> Add New Author
    </a>
</div>

<!-- DataTales -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Author List</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Books Count</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                @if (Model?.Any() == true)
                {
                    foreach (var author in Model)
                    {
                        <tr>
                            <td>@author.Id</td>
                            <td>@author.Name</td>
                            <td>@(author.Books?.Count ?? 0)</td>
                            <td>
                                <a asp-action="Detail" asp-route-id="@author.Id" class="btn btn-sm btn-primary authorDetailBtn">
                                    <i class="fas fa-eye"></i> 
                                </a>
                                <a asp-action="Update" asp-route-id="@author.Id" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i> 
                                </a>
                                <a asp-action="Delete" asp-route-id="@author.Id"
                                   class="btn btn-sm btn-danger deleteAuthor">
                                    <i class="fas fa-trash"></i> 
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center">
                            <div class="py-4">
                                <i class="fas fa-info-circle text-gray-300"></i>
                                <p class="text-muted mb-0">No authors found. Click "Add New Author" to create one.</p>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Author Detail Modal -->
<div class="modal fade" id="authorDetailModal" tabindex="-1" aria-labelledby="authorDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <!-- Modal content will be loaded here -->
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Author Detail Modal
            $('.authorDetailBtn').on('click', function (e) {
                e.preventDefault();
                var url = $(this).attr('href');
                
                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        $('#authorDetailModal .modal-dialog').html(data);
                        
                        // Bootstrap 5 modal aÃ§ma
                        var modalElement = document.getElementById('authorDetailModal');
                        var modal = new bootstrap.Modal(modalElement);
                        modal.show();
                    })
                    .catch(error => {
                        console.error('Error loading author details:', error);
                        Swal.fire("Error", "Failed to load author details", "error");
                    });
            });

            // Delete Author
            $('.deleteAuthor').on('click', function (e) {
                e.preventDefault();
                var link = $(this).attr('href');
                Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to delete this author?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: "Yes, delete it!",
                    cancelButtonText: "Cancel"
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(link).then(response => {
                            if (response.ok) {
                                Swal.fire("Deleted!", "Author has been deleted.", "success").then(() => {
                                    location.reload();
                                });
                            } else {
                                Swal.fire("Error", "Failed to delete author", "error");
                            }
                        }).catch(error => {
                            Swal.fire("Error", "An error occurred", "error");
                        });
                    }
                });
            });
        });
    </script>
}
